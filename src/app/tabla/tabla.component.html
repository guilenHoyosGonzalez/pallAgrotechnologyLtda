<ngx-loading
  [show]="loading"
  [config]="{
    backdropBackgroundColour: 'color: rgb(71, 10, 104) !important',
    animationType: 'wanderingCubes',
    primaryColour: '#1976d2',
    secondaryColour: '#ffffff',
    tertiaryColour: '#ffffff'
  }"
></ngx-loading>

<div *ngIf="loading" class="loading-message">
  <p>Cargando, por favor espere...</p>
  <p>{{ mensaje }}</p>
</div>

<!-- Tu contenido -->
<div *ngIf="!loading">
  <mat-card appearance="outlined">
    <mat-card-header>
      <mat-card-title
        ><h1 class="titulo">Pall Agrotechnology Ltda</h1></mat-card-title
      >
    </mat-card-header>

    <mat-card-content>
      <div style="width: 100%; height: 100%">
        <form [formGroup]="frmFilter">
          <table class="sin-bordes">
            <tr>
              <td>
                <mat-form-field appearance="outline">
                  <label for="especieFilter"> Especie</label><br /><br />
                  <mat-select
                    [(ngModel)]="especieFilter"
                    formControlName="especieFilter"
                  >
                    <mat-option
                      *ngFor="let especie of filtroEspecie"
                      value="{{ especie.id }}"
                    >
                      {{ especie.nombre }}
                    </mat-option>
                  </mat-select>
                </mat-form-field>
              </td>
              <td>
                <mat-form-field appearance="outline">
                  <label for="variedadFilter"> Variedad</label><br /><br />
                  <mat-select
                    [(ngModel)]="variedadFilter"
                    formControlName="variedadFilter"
                  >
                    <mat-option
                      *ngFor="let variedad of filtroVariedad"
                      value="{{ variedad.id }}"
                    >
                      {{ variedad.nombre }}
                    </mat-option>
                  </mat-select>
                </mat-form-field>
              </td>
              <td>
                <mat-form-field appearance="outline">
                  <label for="categoriaFilter">Categoria</label><br /><br />
                  <mat-select
                    [(ngModel)]="categoriaFilter"
                    formControlName="categoriaFilter"
                  >
                    <mat-option
                      *ngFor="let tamano of filtroCategoria"
                      value="{{ tamano.id }}"
                    >
                      {{ tamano.nombre }}
                    </mat-option>
                  </mat-select>
                </mat-form-field>
              </td>
            </tr>
            <tr>
              <td>
                <mat-form-field appearance="outline">
                  <label for="tamanoFilter"> Tamaño</label><br /><br />
                  <mat-select
                    [(ngModel)]="tamanoFilter"
                    formControlName="tamanoFilter"
                  >
                    <mat-option
                      *ngFor="let tamano of filtroTamano"
                      value="{{ tamano.id }}"
                    >
                      {{ tamano.nombre }}
                    </mat-option>
                  </mat-select>
                </mat-form-field>
              </td>
              <td>
                <mat-form-field appearance="outline">
                  <label for="esPoolFilter">esPool</label><br /><br />
                  <mat-select
                    [(ngModel)]="esPoolFilter"
                    formControlName="esPoolFilter"
                  >
                    <mat-option
                      *ngFor="let esPool of filtroEspool"
                      value="{{ esPool.id }}"
                    >
                      {{ esPool.nombre }}
                    </mat-option>
                  </mat-select>
                </mat-form-field>
              </td>
              <td style="text-align: center; margin: 50%">
                <button
                  mat-icon-button
                  matSuffix
                  class="btnFilter"
                  [disabled]="!frmFilter.valid"
                  (click)="applyFilter(frmFilter)"
                >
                  Filtrar
                </button>
              </td>
            </tr>
          </table>
        </form>
      </div>

      <table
        mat-table
        #mytable
        [dataSource]="dataSource"
        matSort
        class="mat-elevation-z8"
        style="width: 100%"
      >
        <ng-container matColumnDef="folio">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Folio Tarja</th>
          <td mat-cell *matCellDef="let item">{{ item.folio.trim() }}111</td>
        </ng-container>

        <ng-container matColumnDef="pool">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Pool</th>
          <td mat-cell *matCellDef="let item">
            {{ item.esPool ? "Sí" : "No" }}
          </td>
        </ng-container>

        <ng-container matColumnDef="fecha">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Fecha Tarja</th>
          <td mat-cell *matCellDef="let item">
            {{ item.fecha | date : "dd/MM/yyyy HH:mm" }}
          </td>
        </ng-container>

        <ng-container matColumnDef="estado">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Estado</th>
          <td mat-cell *matCellDef="let item">
            {{ getEstado(item.completo) }}
          </td>
        </ng-container>

        <ng-container matColumnDef="especie">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Especie</th>
          <td mat-cell *matCellDef="let item">{{ item.especie.nombre }}</td>
        </ng-container>

        <ng-container matColumnDef="variedad">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>
            Variedad Rotulada
          </th>

          <td mat-cell *matCellDef="let item">
            {{ item.variedadRot?.nombre }}
          </td>
        </ng-container>

        <ng-container matColumnDef="categoria">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Categoría</th>
          <td mat-cell *matCellDef="let item">{{ item.categoria.nombre }}</td>
        </ng-container>

        <ng-container matColumnDef="tamano">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Tamaño</th>
          <td mat-cell *matCellDef="let item">{{ item.tamano.nombre }}</td>
        </ng-container>

        <ng-container matColumnDef="contenedor">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Contenedor</th>
          <td mat-cell *matCellDef="let item">{{ item.contenedor.nombre }}</td>
        </ng-container>

        <ng-container matColumnDef="bultos">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Bultos</th>
          <td mat-cell *matCellDef="let item">{{ item.bultos }}</td>
        </ng-container>

        <ng-container matColumnDef="kilos">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Kilos neto</th>
          <td mat-cell *matCellDef="let item">{{ item.kilosNetos }} kg</td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
      </table>
      <br />
      {{ mensaje }}
      <br />
    </mat-card-content>

    <mat-card-footer>
      <mat-paginator
        [pageSizeOptions]="[20, 50, 100]"
        [pageSize]="20"
        showFirstLastButtons
      ></mat-paginator>
    </mat-card-footer>
  </mat-card>
</div>
